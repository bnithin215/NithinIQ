<app-navbar></app-navbar>

<div class="upload-container container">
  <div class="upload-header fade-in">
    <h1 class="upload-title">Upload Documents</h1>
    <p class="upload-subtitle">Add files or text to build your knowledge base</p>
  </div>

  <div class="upload-card card fade-in">
    <div *ngIf="errorMessage" class="alert alert-error">
      {{ errorMessage }}
    </div>

    <div *ngIf="successMessage" class="alert alert-success">
      {{ successMessage }}
    </div>

    <form [formGroup]="uploadForm" (ngSubmit)="uploadFile()">
      <div class="upload-options">
        <!-- File Upload -->
        <div class="upload-section">
          <label class="form-label">Upload File</label>
          <div class="alert alert-info mb-2">
            <strong>Note:</strong> Maximum file size is 900KB. PDF files will have text automatically extracted for AI analysis. For larger files, please use text upload or split into smaller files.
          </div>
          <div
            class="drop-zone"
            [class.dragging]="isDragging"
            (dragover)="onDragOver($event)"
            (dragleave)="onDragLeave($event)"
            (drop)="onDrop($event)"
          >
            <input
              type="file"
              id="fileInput"
              class="file-input"
              (change)="onFileSelected($event)"
              accept=".pdf,.txt,.doc,.docx,.md,.json,.csv"
            />
            <label for="fileInput" class="drop-zone-label">
              <div class="drop-zone-icon">üìÅ</div>
              <p class="drop-zone-text">
                Drag and drop a file here, or <span class="drop-zone-link">browse</span>
              </p>
              <p class="drop-zone-hint">Supports PDF, TXT, DOC, DOCX, MD, JSON, CSV (Max: 900KB)</p>
            </label>
          </div>

          <div *ngIf="selectedFile" class="selected-file">
            <div class="file-info">
              <span class="file-icon">üìÑ</span>
              <div class="file-details">
                <div class="file-name">{{ selectedFile.name }}</div>
                <div class="file-size">{{ formatFileSize(selectedFile.size) }}</div>
                <div *ngIf="fileSizeWarning" class="file-size-warning alert alert-error mt-2">
                  {{ fileSizeWarning }}
                </div>
              </div>
            </div>
            <button type="button" class="btn btn-danger btn-sm" (click)="removeFile()">Remove</button>
          </div>
        </div>

        <!-- Text Upload -->
        <div class="divider">
          <span>OR</span>
        </div>

        <div class="upload-section">
          <label class="form-label">Add Text Content</label>
          <div class="form-group">
            <input
              type="text"
              formControlName="title"
              class="form-input"
              placeholder="Enter document title"
              [class.error]="uploadForm.get('title')?.invalid && uploadForm.get('title')?.touched"
            />
          </div>
          <div class="form-group">
            <textarea
              formControlName="textContent"
              class="form-input"
              placeholder="Enter your text content here..."
              rows="10"
            ></textarea>
          </div>
        </div>
      </div>

      <button
        type="submit"
        class="btn btn-primary btn-full mt-3"
        [disabled]="isLoading || (!selectedFile && !uploadForm.get('textContent')?.value) || (selectedFile && selectedFile.size > maxFileSize)"
      >
        <span *ngIf="!isLoading">Upload Document</span>
        <span *ngIf="isLoading" class="spinner-small"></span>
      </button>
    </form>
  </div>
</div>
